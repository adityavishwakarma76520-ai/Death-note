<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Death Note</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Nanum+Pen+Script&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        :root {
            --paper-color: #f0e6d2;
            --ink-color: #1a1a1a;
            --rule-line: #a8a8a8;
        }

        body {
            background-color: #000;
            color: #ddd;
            font-family: 'Old Standard TT', serif;
            overflow-x: hidden;
            cursor: default;
        }

        /* Custom Fonts */
        .font-gothic { font-family: 'Cinzel', serif; }
        .font-rules { font-family: 'Special Elite', cursive; }
        .font-handwriting { font-family: 'Nanum Pen Script', cursive; font-size: 1.8rem; }
        .font-standard { font-family: 'Old Standard TT', serif; }

        /* Animations */
        @keyframes flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; text-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
            20%, 24%, 55% { opacity: 0.5; text-shadow: none; }
        }

        @keyframes glitch {
            0% { clip-path: inset(40% 0 61% 0); transform: translate(-2px, 2px); }
            20% { clip-path: inset(92% 0 1% 0); transform: translate(2px, -2px); }
            40% { clip-path: inset(43% 0 1% 0); transform: translate(-2px, 2px); }
            60% { clip-path: inset(25% 0 58% 0); transform: translate(2px, -2px); }
            80% { clip-path: inset(54% 0 7% 0); transform: translate(-2px, 2px); }
            100% { clip-path: inset(58% 0 43% 0); transform: translate(2px, -2px); }
        }

        @keyframes rain {
            0% { background-position: 0 0; }
            100% { background-position: 10% 100%; }
        }

        @keyframes writeStroke {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-flicker { animation: flicker 4s infinite; }
        .animate-fade-in { animation: fadeIn 1s ease-out forwards; }
        .animate-glitch { animation: glitch 1s infinite linear alternate-reverse; }

        /* Rain Effect Overlay */
        .rain-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://raw.githubusercontent.com/gniezen/rain-js/master/img/weather-rain.png');
            opacity: 0.3;
            animation: rain 1s linear infinite;
            pointer-events: none;
            z-index: 5;
            display: none;
        }

        /* Page Layouts */
        .screen {
            display: none;
            min-height: 100vh;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.5s ease;
            background-size: cover;
            background-position: center;
        }
        .screen.active { display: flex; }

        /* Notebook Paper Effect */
        .notebook-page {
            background-color: var(--paper-color);
            background-image: 
                linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px),
                linear-gradient(#eee .1em, transparent .1em);
            background-size: 100% 1.5em;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5), 5px 5px 15px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .notebook-page::before {
            content: '';
            position: absolute;
            top: 0; bottom: 0; left: 0; width: 80px;
            background: linear-gradient(to right, rgba(0,0,0,0.2), transparent);
            border-right: 2px solid rgba(0,0,0,0.1);
        }

        /* Input Styling */
        .ink-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid #555;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 2rem;
            color: #222;
            outline: none;
            transition: border-color 0.3s;
        }
        .ink-input:focus { border-bottom-color: #000; }
        .ink-input::placeholder { color: #888; opacity: 0.5; font-family: 'Old Standard TT', serif; font-size: 1.2rem; }

        /* Shinigami & Symbol Images */
        .intro-symbol {
            width: 200px;
            height: 200px;
            object-fit: contain;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.2));
            mix-blend-mode: screen;
            transition: all 0.5s ease;
            cursor: pointer;
        }
        .intro-symbol:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 25px rgba(255, 255, 255, 0.4));
        }

        /* Shinigami Models Overlay */
        .shinigami-overlay {
            position: fixed;
            bottom: -50px;
            right: -50px;
            width: 500px;
            height: 600px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom right;
            opacity: 0;
            transition: opacity 1s ease, transform 1s ease, background-image 0.5s ease;
            pointer-events: none;
            z-index: 40;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8));
        }
        .shinigami-overlay.visible { opacity: 0.9; transform: translate(-20px, -20px); }

        /* Speech Bubble */
        .shinigami-bubble {
            position: fixed;
            bottom: 450px;
            right: 300px;
            max-width: 250px;
            background: #fff;
            color: #000;
            padding: 15px;
            border-radius: 20px;
            border-bottom-right-radius: 0;
            font-family: 'Special Elite', cursive;
            font-size: 0.9rem;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            opacity: 0;
            transform: translateY(20px) scale(0.9);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            z-index: 49;
        }
        .shinigami-bubble.visible { opacity: 1; transform: translateY(0) scale(1); }
        .shinigami-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 0;
            width: 20px;
            height: 20px;
            background: #fff;
            clip-path: polygon(0 0, 100% 0, 100% 100%);
        }

        /* Rules Container */
        .rules-bg {
            background-color: #000;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
            border: 2px solid #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        .loading-sparkle { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* Custom Select for Shinigami */
        .shinigami-select {
            appearance: none;
            background: rgba(0,0,0,0.8);
            color: #aaa;
            border: 1px solid #444;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            cursor: pointer;
            text-align: center;
        }
        .shinigami-select:hover { color: white; border-color: #888; }
    </style>
</head>
<body>

    <div class="noise-overlay fixed inset-0 z-50 pointer-events-none opacity-[0.05] bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZmlsdGVyIGlkPSJnoiPjxmZVR1cmJ1bGVuY2UgdHlwZT0iZnJhY3RhbE5vaXNlIiBiYXNlRnJlcXVlbmN5PSIwLjY1IiBudW1PY3RhdmVzPSIzIiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI2cpIiBvcGFjaXR5PSIwLjUiLz48L3N2Zz4=')]"></div>
    <div id="rain" class="rain-overlay"></div>

    <!-- Shinigami Visuals -->
    <div id="shinigami-model" class="shinigami-overlay"></div>
    <div id="shinigami-bubble" class="shinigami-bubble">Humans are so interesting...</div>

    <!-- SECTION 1: ENTRANCE -->
    <div id="intro-screen" class="screen active flex-col items-center justify-center bg-black z-30" 
         style="background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url('http://googleusercontent.com/image_collection/image_retrieval/17540684503235995590');">
        
        <div class="text-center animate-fade-in cursor-pointer group relative flex flex-col items-center" onclick="startExperience()">
            
            <!-- Clickable Symbol Switcher -->
            <div class="relative w-64 h-64 mb-8 flex items-center justify-center" title="Click to change Symbol">
                <img id="intro-symbol-img" 
                     src="http://googleusercontent.com/image_collection/image_retrieval/6519832728640622123" 
                     class="intro-symbol animate-glitch opacity-0 group-hover:opacity-100 transition-opacity duration-1000" 
                     onclick="cycleSymbol(event)">
                <div class="absolute bottom-[-30px] text-gray-600 text-xs font-mono opacity-50">CLICK TO CHANGE</div>
            </div>
            
            <h1 class="death-note-title text-5xl md:text-8xl text-white group-hover:text-gray-300 transition-colors relative z-10">Death Note</h1>
            <p class="text-gray-400 font-gothic mt-6 tracking-[0.5em] text-sm md:text-lg animate-flicker uppercase">The Human whose name is written in this note shall die.</p>
            
            <div class="mt-16 w-40 h-12 border-b-2 border-white flex items-center justify-center mx-auto transform hover:tracking-[0.5em] transition-all duration-500 cursor-pointer">
                <span class="font-gothic text-xl text-white">ENTER</span>
            </div>
        </div>
    </div>

    <!-- SECTION 2: HOW TO USE (RULES) -->
    <div id="rules-screen" class="screen flex-col items-center justify-center bg-zinc-900 z-20" style="background-image: radial-gradient(#222, #000);">
        <div class="rules-bg p-8 md:p-12 max-w-2xl w-[90%] relative min-h-[500px] flex flex-col justify-between">
            <!-- Decorative Corners -->
            <div class="absolute top-4 left-4 border-t-2 border-l-2 border-gray-600 w-8 h-8"></div>
            <div class="absolute top-4 right-4 border-t-2 border-r-2 border-gray-600 w-8 h-8"></div>
            <div class="absolute bottom-4 left-4 border-b-2 border-l-2 border-gray-600 w-8 h-8"></div>
            <div class="absolute bottom-4 right-4 border-b-2 border-r-2 border-gray-600 w-8 h-8"></div>

            <div id="rules-content" class="text-center">
                <h2 id="rule-title" class="font-gothic text-3xl mb-12 text-white border-b border-gray-800 pb-4">How to Use: I</h2>
                <div id="rule-text" class="font-rules text-xl md:text-2xl leading-relaxed text-gray-300 space-y-6">
                    <!-- Text injected by JS -->
                </div>
            </div>

            <div class="flex justify-between items-center mt-12 px-4">
                <button onclick="prevRule()" id="prev-btn" class="text-gray-500 hover:text-white font-gothic opacity-0 pointer-events-none transition-opacity">PREVIOUS</button>
                <div class="flex gap-2">
                    <span class="w-2 h-2 rounded-full bg-white opacity-100" id="dot-0"></span>
                    <span class="w-2 h-2 rounded-full bg-white opacity-30" id="dot-1"></span>
                    <span class="w-2 h-2 rounded-full bg-white opacity-30" id="dot-2"></span>
                </div>
                <button onclick="nextRule()" id="next-btn" class="text-gray-500 hover:text-white font-gothic">NEXT</button>
            </div>
            
            <button id="start-btn" onclick="openNotebook()" class="absolute bottom-[-60px] left-1/2 transform -translate-x-1/2 text-white font-gothic tracking-widest hover:text-red-600 transition-colors opacity-0 pointer-events-none">
                OPEN NOTEBOOK
            </button>
        </div>
    </div>

    <!-- SECTION 3: THE NOTEBOOK -->
    <div id="notebook-screen" class="screen flex-col items-center bg-black z-10 py-10" style="background-color: #0a0a0a;">
        <!-- Header -->
        <div class="w-full max-w-4xl flex justify-between items-center px-4 mb-6 text-gray-500">
            <button onclick="goToRules()" class="hover:text-white font-gothic text-sm tracking-widest">RULES</button>
            <div class="flex flex-col items-center">
                <div class="font-gothic text-2xl tracking-[0.3em] text-gray-300">DEATH NOTE</div>
                <div class="mt-1 flex items-center gap-2">
                    <span class="text-[10px] text-gray-600 uppercase">Haunted By:</span>
                    <select id="shinigami-selector" class="shinigami-select" onchange="changeShinigami(this.value)">
                        <option value="ryuk">Ryuk</option>
                        <option value="rem">Rem</option>
                        <option value="sidoh">Sidoh</option>
                    </select>
                </div>
            </div>
            <div class="text-xs font-mono" id="clock">00:00:00</div>
        </div>

        <!-- The Page -->
        <div class="notebook-page w-full max-w-4xl h-[80vh] overflow-y-auto relative rounded-r-md p-8 md:p-12">
            
            <!-- Input Area -->
            <div class="mb-10 pl-12 md:pl-20 relative">
                <div class="flex flex-col md:flex-row gap-6 md:items-end">
                    <div class="flex-grow">
                        <label class="block font-standard text-xs text-gray-600 uppercase tracking-widest mb-2">Name of Victim</label>
                        <input type="text" id="nameInput" class="ink-input w-full bg-transparent" placeholder="Enter name..." autocomplete="off">
                    </div>
                    <div class="w-full md:w-5/12">
                        <label class="block font-standard text-xs text-gray-600 uppercase tracking-widest mb-2 flex items-center justify-between">
                            Cause of Death
                            <button onclick="generateCause()" id="ai-btn" class="text-[10px] bg-black text-white px-3 py-1 rounded hover:bg-gray-800 transition-colors flex items-center gap-1 shadow-md" title="Consult Shinigami">
                                <span>â€  Consult</span>
                            </button>
                        </label>
                        <input type="text" id="causeInput" class="ink-input w-full bg-transparent text-sm" placeholder="Heart Attack (Default)" autocomplete="off">
                    </div>
                    <button onclick="writeName()" class="h-12 px-8 bg-black text-white font-gothic hover:bg-red-900 transition-colors duration-500 shadow-xl border border-gray-800">
                        WRITE
                    </button>
                </div>
                <div id="error-msg" class="text-red-900 font-handwriting text-xl mt-4 h-6 opacity-0 transition-opacity pl-2"></div>
            </div>

            <!-- Written Names List -->
            <div id="names-list" class="space-y-1 pl-12 md:pl-20 pb-20">
                <!-- Names will be injected here via JS -->
            </div>
        </div>
    </div>

    <!-- Apple Toggle -->
    <div class="ryuk-apple fixed bottom-5 right-5 w-10 h-10 cursor-pointer opacity-50 hover:opacity-100 transition-all z-50 hover:scale-110" onclick="toggleVisibility()" title="Toggle Shinigami Visibility">
        <svg viewBox="0 0 24 24" fill="currentColor" class="text-red-700 w-full h-full drop-shadow-lg filter blur-[0.5px]">
            <path d="M12,2C12,2 11,1 10,2C9,3 8,4 8,4C8,4 5,5 5,9C5,13.4 8.6,17 13,17C14.1,17 15.2,16.8 16.2,16.4C17.3,16 18,15 18,13.8C18,12.2 16.9,10.8 15.5,10.4C15.5,10.4 16,9 16,9C16,9 15.5,6.5 14,5C12.5,3.5 12,2 12,2M13,3.5C13.5,3.5 14,4 14,4.5C14,5 13.5,5.5 13,5.5C12.5,5.5 12,5 12,4.5C12,4 12.5,3.5 13,3.5Z" />
        </svg>
    </div>

    <script>
        const apiKey = ""; 

        // --- Data ---
        const rules = [
            {
                title: "How to Use: I",
                text: [
                    "The human whose name is written in this note shall die.",
                    "This note will not take effect unless the writer has the person's face in mind when writing his/her name. Therefore, people sharing the same name will not be affected."
                ]
            },
            {
                title: "How to Use: II",
                text: [
                    "If the cause of death is written within 40 seconds of writing the person's name, it will happen.",
                    "If the cause of death is not specified, the person will simply die of a heart attack."
                ]
            },
            {
                title: "How to Use: III",
                text: [
                    "After writing the cause of death, details of the death should be written in the next 6 minutes and 40 seconds.",
                    "You cannot kill humans at the age of 124 or over with the Death Note."
                ]
            }
        ];

        // Assets
        const shinigamiData = {
            ryuk: {
                img: 'http://googleusercontent.com/image_collection/image_retrieval/17910600368827640901',
                prompt: "You are Ryuk from Death Note. Cynical, bored, likes apples. Reaction to death:",
                intro: "Humans are so interesting..."
            },
            rem: {
                img: 'http://googleusercontent.com/image_collection/image_retrieval/2539000009042741001',
                prompt: "You are Rem from Death Note. Serious, protective of Misa, dislikes Light. Reaction to death:",
                intro: "I watch over the owner..."
            },
            sidoh: {
                img: 'http://googleusercontent.com/image_collection/image_retrieval/12365078089906303863',
                prompt: "You are Sidoh from Death Note. Cowardly, dumb, just wants his notebook back. Reaction to death:",
                intro: "I... I just want my notebook back."
            }
        };

        const symbols = [
            'http://googleusercontent.com/image_collection/image_retrieval/6519832728640622123', // Ryuk/Shinigami
            'http://googleusercontent.com/image_collection/image_retrieval/11751643081395635779', // Eyes
            'http://googleusercontent.com/image_collection/image_retrieval/17486133451905214993', // N
            'http://googleusercontent.com/image_collection/image_retrieval/12479665566923136048'  // M
        ];

        // State
        let currentRuleIndex = 0;
        let isVisible = false;
        let currentShinigami = 'ryuk';
        let currentSymbolIndex = 0;

        // --- Navigation Logic ---

        function startExperience() {
            document.getElementById('rain').style.display = 'block';
            switchScreen('rules-screen');
            updateRuleDisplay();
        }

        function goToRules() {
            switchScreen('rules-screen');
        }

        function openNotebook() {
            switchScreen('notebook-screen');
            document.getElementById('nameInput').focus();
            changeShinigami('ryuk'); // Default
            setTimeout(() => {
                toggleVisibility(true);
            }, 2000);
        }

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => {
                s.style.opacity = '0';
                setTimeout(() => s.classList.remove('active'), 500);
            });
            setTimeout(() => {
                const target = document.getElementById(screenId);
                target.classList.add('active');
                void target.offsetWidth;
                target.style.opacity = '1';
            }, 500);
        }

        // --- Intro Symbol Logic ---
        function cycleSymbol(e) {
            e.stopPropagation();
            currentSymbolIndex = (currentSymbolIndex + 1) % symbols.length;
            const img = document.getElementById('intro-symbol-img');
            img.style.opacity = '0';
            setTimeout(() => {
                img.src = symbols[currentSymbolIndex];
                img.style.opacity = '1';
            }, 300);
        }

        // --- Shinigami Logic ---
        function changeShinigami(key) {
            currentShinigami = key;
            const data = shinigamiData[key];
            const overlay = document.getElementById('shinigami-model');
            const bubble = document.getElementById('shinigami-bubble');
            
            overlay.style.backgroundImage = `url('${data.img}')`;
            
            if (isVisible) {
                bubble.innerText = data.intro;
                bubble.classList.add('visible');
                setTimeout(() => bubble.classList.remove('visible'), 3000);
            }
        }

        function toggleVisibility(forceState) {
            isVisible = forceState !== undefined ? forceState : !isVisible;
            const overlay = document.getElementById('shinigami-model');
            if (isVisible) {
                overlay.classList.add('visible');
            } else {
                overlay.classList.remove('visible');
            }
        }

        // --- Rules Pagination ---

        function updateRuleDisplay() {
            const rule = rules[currentRuleIndex];
            const content = document.getElementById('rules-content');
            
            content.style.opacity = '0';
            
            setTimeout(() => {
                document.getElementById('rule-title').innerText = rule.title;
                document.getElementById('rule-text').innerHTML = rule.text.map(p => `<p>${p}</p>`).join('');
                
                [0, 1, 2].forEach(i => {
                    document.getElementById(`dot-${i}`).style.opacity = i === currentRuleIndex ? '1' : '0.3';
                });

                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                const startBtn = document.getElementById('start-btn');

                if (currentRuleIndex === 0) {
                    prevBtn.style.opacity = '0';
                    prevBtn.style.pointerEvents = 'none';
                } else {
                    prevBtn.style.opacity = '1';
                    prevBtn.style.pointerEvents = 'auto';
                }

                if (currentRuleIndex === rules.length - 1) {
                    nextBtn.style.display = 'none';
                    startBtn.style.opacity = '1';
                    startBtn.style.pointerEvents = 'auto';
                } else {
                    nextBtn.style.display = 'block';
                    startBtn.style.opacity = '0';
                    startBtn.style.pointerEvents = 'none';
                }

                content.style.opacity = '1';
            }, 300);
        }

        function nextRule() { if (currentRuleIndex < rules.length - 1) { currentRuleIndex++; updateRuleDisplay(); } }
        function prevRule() { if (currentRuleIndex > 0) { currentRuleIndex--; updateRuleDisplay(); } }

        // --- AI & Logic ---

        async function generateCause() {
            const name = document.getElementById('nameInput').value.trim();
            const btn = document.getElementById('ai-btn');
            const causeInput = document.getElementById('causeInput');

            if (!name) {
                showError("Name required for Shinigami eyes...");
                return;
            }

            const originalText = btn.innerHTML;
            btn.innerHTML = `<svg class="loading-sparkle w-3 h-3 text-white" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>`;
            btn.disabled = true;

            try {
                const prompt = `Invent a creative, specific, and dramatic Death Note style cause of death for a character named '${name}'. Max 8 words. Return ONLY the cause text.`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                const suggestion = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                if (suggestion) {
                    causeInput.value = suggestion;
                    causeInput.classList.add('animate-pulse');
                    setTimeout(() => causeInput.classList.remove('animate-pulse'), 500);
                }
            } catch (error) {
                causeInput.value = "Heart Attack (Connection Failed)";
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function triggerShinigamiCommentary(name, cause) {
            const bubble = document.getElementById('shinigami-bubble');
            const data = shinigamiData[currentShinigami];
            
            try {
                const prompt = `${data.prompt} Someone named '${name}' is dying of '${cause}'. 1 short sentence reaction.`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const result = await response.json();
                const comment = result.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                if (comment) {
                    bubble.textContent = comment;
                    bubble.classList.add('visible');
                    setTimeout(() => bubble.classList.remove('visible'), 6000);
                }
            } catch (e) { console.log("Shinigami silent"); }
        }

        function writeName() {
            const nameInput = document.getElementById('nameInput');
            const causeInput = document.getElementById('causeInput');
            const list = document.getElementById('names-list');
            const name = nameInput.value.trim();
            let cause = causeInput.value.trim() || "Heart Attack";

            if (!name) {
                showError("Visualize the face...");
                return;
            }

            const timestamp = new Date().toLocaleTimeString();
            const row = document.createElement('div');
            row.className = "flex justify-between items-baseline border-b border-transparent hover:border-gray-300 transition-colors py-3 group";
            row.innerHTML = `
                <div class="flex-grow">
                    <span class="font-handwriting text-3xl md:text-4xl text-black block w-0 whitespace-nowrap overflow-hidden" 
                          style="animation: writeStroke 1.5s ease-out forwards; border-right: 2px solid rgba(0,0,0,0.5);">
                        ${name}
                    </span>
                    <span class="font-standard text-xs text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity uppercase tracking-wider">
                        ${cause}
                    </span>
                </div>
                <div class="font-mono text-xs text-gray-400 opacity-0 animate-[fadeIn_2s_ease_forwards_1s]">
                    ${timestamp}
                </div>
            `;

            list.insertBefore(row, list.firstChild);
            setTimeout(() => row.querySelector('.font-handwriting').style.borderRight = 'none', 1500);

            // Simulating 40 second rule (sped up for UX)
            setTimeout(() => {
                if(document.body.contains(row)) {
                    row.style.backgroundColor = "rgba(0,0,0,0.03)";
                    const status = row.querySelector('.font-standard');
                    status.innerHTML = `<span style="color: #8a0000; font-weight: bold;">[DECEASED: ${cause}]</span>`;
                    status.style.opacity = '1';
                }
            }, 6000);

            triggerShinigamiCommentary(name, cause);
            nameInput.value = '';
            causeInput.value = '';
            nameInput.focus();
        }

        function showError(msg) {
            const el = document.getElementById('error-msg');
            el.innerText = msg;
            el.style.opacity = '1';
            setTimeout(() => el.style.opacity = '0', 3000);
        }

        // --- Utils ---
        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-US', { hour12: false }), 1000);
        
        document.getElementById('nameInput').addEventListener('keypress', (e) => { if(e.key==='Enter') document.getElementById('causeInput').focus(); });
        document.getElementById('causeInput').addEventListener('keypress', (e) => { if(e.key==='Enter') writeName(); });

        console.log("Gods of death love apples.");
    </script>
</body>
</html>